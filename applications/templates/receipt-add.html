<!DOCTYPE html>
<html>

<head>

    <script src="{{ url_for('static', filename='assets/js/vendor/jquery-2.2.4.min.js') }}"></script>
    <!-- bootstrap 4 js -->
    <script src="{{ url_for('static', filename='assets/js/popper.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/owl.carousel.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/metisMenu.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/jquery.slimscroll.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/jquery.slicknav.min.js') }}"></script>


    <!-- all line chart activation -->
    <script src="{{ url_for('static', filename='assets/js/line-chart.js') }}"></script>
    <!-- all pie chart -->
    <script src="{{ url_for('static', filename='assets/js/pie-chart.js') }}"></script>
    <!-- others plugins -->
    <script src="{{ url_for('static', filename='assets/js/plugins.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/scripts.js') }}"></script>
    <link rel="stylesheedt" type="text/css" href="{{ url_for('static', filename='assets/css/bootstrap.min.css') }}" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Terima Barang</title>
    <link rel="shortcut icon" type="image/png"
        href="{{ url_for('static', filename='assets/images/icon/favicon.ico') }}" />
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/css/bootstrap.min.css') }}" />
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/css/font-awesome.min.css') }}" />
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/css/themify-icons.css') }}" />
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/css/metisMenu.css') }}" />
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/css/owl.carousel.min.css') }}" />
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/css/slicknav.min.css') }}" />
    <!-- amchart css -->
    <link rel="stylesheet" type="text/css" href="https://www.amcharts.com/lib/3/plugins/export/export.css"
        media="all" />
    <!-- others css -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/css/typography.css') }}" />
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/css/default-css.css') }}" />
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/css/styles.css') }}" />
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/css/responsive.css') }}" />
    <script src="{{ url_for('static', filename='assets/js/tambahanCdr.js') }}"></script>

    <!-- modernizr css -->
    <script src="{{ url_for('static', filename='assets/js/vendor/modernizr-2.8.3.min.js') }}"></script>

    <!-- DataTables -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/css/datatables.min.css') }}">
    <script src="{{ url_for('static', filename='assets/js/datatables.min.js') }}"></script>

    <!-- SweetAlert 2 -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/css/sweetalert2.min.css') }}">
    <script src="{{ url_for('static', filename='assets/js/sweetalert2.all.min.js') }}"></script>

    <!-- printJS -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/css/print.min.css') }}">
    <script src="{{ url_for('static', filename='assets/js/print.min.js') }}"></script>

    <style>
        .input-container input {
            border: none;
            box-sizing: border-box;
            outline: 0;
            padding: .75rem;
            position: relative;
            width: 100%;
        }

        input[type="date"]::-webkit-calendar-picker-indicator {
            background: transparent;
            bottom: 0;
            color: transparent;
            cursor: pointer;
            height: auto;
            left: 0;
            position: absolute;
            right: 0;
            top: 0;
            width: auto;
        }

        body {
            font-family: 'Circular Std Book';
            font-style: normal;
            font-weight: normal;
            font-size: 14px;
            color: #71748d;
            background-color: #efeff6;
            -webkit-font-smoothing: antialiased;
        }

        .mt-20 {
            margin-top: 50px !important;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            color: #3d405c;
            margin: 0px 0px 15px 0px;
            font-family: 'Circular Std Medium';
        }

        h1 {
            font-size: 34px;
        }

        h2 {
            font-size: 28px;
            line-height: 30px;
        }

        h3 {
            font-size: 20px;
        }

        h4 {
            font-size: 16px;
            line-height: 26px;
        }

        h5 {
            font-size: 15px;
            line-height: 26px;
        }

        h6 {
            font-size: 12px;
        }

        p {
            margin: 0px 0px 20px 0px;
        }

        p:last-child {
            margin: 0px;
        }

        a {
            color: #71748d;
        }

        a:hover {
            color: #ff407b;
            text-decoration: none;
        }

        a:active,
        a:hover {
            outline: 0;
            text-decoration: none;
        }

        .btn-secondary {
            color: #fff;
            background-color: #ff407b;
            border-color: #ff407b;
        }

        .btn {
            font-size: 14px;
            padding: 9px 16px;
            border-radius: 2px;
        }


        .tab-vertical .nav.nav-tabs {
            float: left;
            display: block;
            margin-right: 0px;
            border-bottom: 0;
        }

        .tab-vertical .nav.nav-tabs .nav-item {
            margin-bottom: 6px;
        }

        .tab-vertical .nav-tabs .nav-link {
            border: 1px solid transparent;
            border-top-left-radius: .25rem;
            border-top-right-radius: .25rem;
            background: #fff;
            padding: 17px 49px;
            color: #71748d;
            background-color: #dddde8;
            -webkit-border-radius: 4px 0px 0px 4px;
            -moz-border-radius: 4px 0px 0px 4px;
            border-radius: 4px 0px 0px 4px;
        }

        .tab-vertical .nav-tabs .nav-link.active {
            color: #5969ff;
            background-color: #fff !important;
            border-color: transparent !important;
        }

        .tab-vertical .nav-tabs .nav-link {
            border: 1px solid transparent;
            border-top-left-radius: 4px !important;
            border-top-right-radius: 0px !important;
        }

        .tab-vertical .tab-content {
            overflow: auto;
            -webkit-border-radius: 0px 4px 4px 4px;
            -moz-border-radius: 0px 4px 4px 4px;
            border-radius: 0px 4px 4px 4px;
            background: #fff;
            padding: 30px;
        }

        .nav-tabs .nav-item .nav-link {
            background-color: #FFF;
            color: #0080FF;
        }

        .nav-tabs .nav-item .nav-link.active {
            color: #FFF;
            background-color: #0080FF !important;
        }

        .tab-content {
            border: 1px solid #dee2e6;
            border-left: transparent;
        }

        .tab-content .tab-pane {
            background-color: #FFF;
            color: #0080FF;
        }

        .font-order {
            font-size: 18px;
        }

        .font-form {
            font-size: 15px;
        }

        .right {
            float: right;
        }

        .left {
            float: left;
        }

        .table-hover tbody tr:hover td,
        .table-hover tbody tr:hover th {
            background-color: aqua;
        }

        .hide {
            display: none;
        }
    </style>
</head>

<body>
    <div class="d-flex justify-content-center mt-20 mx-5">
        <div class="fixed-top px-5 bg-light row">
            <button class="btn btn-light col-auto text-secondary" style="font-size: 24px;"
                onclick="on_dismiss()">&#10006;</button>
            <h2 class="col-auto my-auto">Terima Barang</h2>
        </div>
        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 mb-5 mt-5">
            <div class="tab-vertical">
                <ul class="nav nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="detail-invoice-tab" data-toggle="tab" href="#detail-invoice"
                            role="tab" aria-controls="home" aria-selected="true">Detail Terima Barang</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="informasi-produk-tab" data-toggle="tab" href="#informasi-produk"
                            role="tab" aria-controls="profile" aria-selected="false">Informasi Produk</a>
                    </li>
                </ul>
                <!-- Detail Produk -->
                <div class="tab-content px-5" id="myTabContent">
                    <!-- Detail Invoice -->
                    <div class="tab-pane fade show active" id="detail-invoice" role="tabpanel"
                        aria-labelledby="detail-invoice-tab">
                        <div class="container">
                            <h2 class="my-2 mb-4">Detail Terima Barang</h2>
                            <div class="form-group row font-form">
                                <label for="outletInvoice" class="col-sm-2 col-form-label">Toko</label>
                                <select class="form-control col-sm-5" id="outletInvoice">
                                    {% for x in data_outlet %}
                                    <option value="{{ x['outlet_id'] }}"> {{ x['outlet_name'] }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="form-group row font-form">
                                <label for="tanggalInvoice" class="col-sm-2 col-form-label">Tanggal</label>
                                <input type="date" class="form-control col-sm-5" id="tanggalInvoice" required>
                            </div>
                            <div class="form-group row font-form">
                                <label for="storeBuy" class="col-sm-2 col-form-label">Toko Beli</label>
                                <input type="text" class="form-control col-sm-5" id="storeBuy" required>
                            </div>

                            <div class="d-flex justify-content-end mt-5">
                                <button type="button" class="btn btn-info" onclick="lastTabGroup()">
                                    <b>Selanjutnya &gt;</b>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="informasi-produk" role="tabpanel"
                        aria-labelledby="informasi-produk-tab">
                        <h2 class="mb-4">Pilih Produk</h2>
                        <div class="form-row">
                            <div class="form-group col-11">
                                <input type="text" class="form-control font-order" id="inputSkuBarcode"
                                    placeholder="Masukkan SKU atau scan barcode" autofocus required>
                            </div>
                            <div class="form-group col-1">
                                <button class="btn btn-danger font-order" id="btn-lovModal" data-toggle="modal"
                                    data-target="#lovModal">Cari</button>
                            </div>
                        </div>
                        <div class="table-responsive text-dark mt-2">
                            <table id="table_product" class="table table-hover table-bordered table-striped w-100 mb-2"
                                style="white-space: nowrap;">
                                <thead class="thead-dark">
                                    <th class="text-center">SKU</th>
                                    <th class="text-center">Part Number</th>
                                    <th class="text-center">Nama Produk</th>
                                    <th class="text-center">Merk</th>
                                    <th class="text-center">Qty</th>
                                    <th class="text-center">Harga Beli</th>
                                    <th class="text-center">Harga Jual</th>
                                    <th class="text-center">Total</th>
                                    <th class="text-center">&nbsp;</th>
                                </thead>
                                <tbody class="font-order"></tbody>
                            </table>
                            <table class="font-order table table-borderless w-100">
                                <thead>
                                    <th class="w-75 text-right pr-5 text-primary"><b>Sub Total</b></th>
                                    <th class="w-25 text-center text-primary" id="subtotal_product"><b>Rp 0</b>
                                    </th>
                                </thead>
                            </table>
                        </div>

                        <!-- Informasi Lainnya -->
                        <div class="row">
                            <div class="container col-12">
                                <h2 class="my-2 mb-4">Informasi Lainnya</h2>
                                <div class="form-group row font-form">
                                    <label for="biayaOngkir" class="col-sm-3 col-form-label">Biaya Pengiriman</label>
                                    <div class="col-sm-7">
                                        <input type="number" onfocus="autoSelect(this)" class="form-control font-form"
                                            id="biayaOngkir" min="0" required value="0">
                                    </div>
                                </div>
                                <div class="form-group row font-form">
                                    <label for="otherInfo" class="col-sm-3 col-form-label">Keterangan</label>
                                    <div class="col-sm-7">
                                        <textarea class="form-control font-form" id="otherInfo" rows="3"></textarea>
                                    </div>
                                </div>

                                <table class="font-order table table-borderless w-100">
                                    <thead>
                                        <th class="w-25 text-center pr-5 text-danger"><b>Total Harga</b></th>
                                        <th class="w-75 text-danger" id="totalHjual"><b>Rp 0</b>
                                        </th>
                                    </thead>
                                </table>
                            </div>

                            <!-- Diskon -->
                            <div class="container col-6" hidden>
                                <h2 class="my-2 mb-4">Diskon</h2>
                                <div class="form-group row font-form">
                                    <label for="discount" class="col-sm-5 col-form-label">Diskon (Rp)</label>
                                    <div class="col-sm-7">
                                        <input type="number" onfocus="autoSelect(this)" class="form-control font-form"
                                            id="discount" min="0" required value="0">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between">
                            <button type="button" class="btn btn-dark" onclick="firstTabGroup()">
                                <b>&lt; Previous</b>
                            </button>
                            <button type="button" class="btn btn-danger" onclick="saveInvoice()">
                                <b>Selesai</b>
                            </button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Modal LOV -->
    <div class="modal fade" id="lovModal" tabindex="-1" role="dialog" aria-labelledby="lovModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="lovModalLabel">Cari Product</h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body">
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" placeholder="cari produk..." id="search_table_lov">
                        <div class="input-group-append">
                            <span class="input-group-text" id="basic-addon2">
                                <i class="fa fa-search"></i>
                            </span>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table id="table_lov_product"
                            class="table table-hover table-bordered table-striped w-100 h-100 mb-2 font-order text-dark"
                            style="white-space: nowrap;">
                            <thead class="thead-dark">
                                <th class="text-center">SKU</th>
                                <th class="text-center">Part Number</th>
                                <th class="text-center">Nama Produk</th>
                                <th class="text-center">Merk</th>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        $(() => {
            var now = new Date();
            var y = now.getFullYear();
            var m = now.getMonth() + 1;
            var d = now.getDate();

            m = m < 10 ? "0" + m : m;
            d = d < 10 ? "0" + d : d;

            document.querySelector("input[type=date]").value = y + "-" + m + "-" + d;
        });
        //================================ Product ================================
        const table = new DataTable('#table_product', {
            "bPaginate": false,
            "bFilter": false,
            scrollCollapse: true,
            ordering: false,
            scrollY: '60vh',
            dom: '<"top left"f>r<"top right"i>t<"clear">',
            columnDefs: [{ width: '12%', targets: 4 }, { width: '18%', targets: [5, 6] }]
        })


        $("#inputSkuBarcode").on('keyup', function (e) {
            if (e.key === 'Enter' || e.keyCode === 13) {
                input = $("#inputSkuBarcode").val()
                if (input) {
                    getDataBySkuBarcode(input)
                } else {
                    Swal.fire({
                        title: "Data Kosong",
                        text: "Mohon input SKU atau Scan Barcode",
                        icon: "error"
                    });
                }
            }
        });

        function checkSkuExist(input) {
            var status = false
            var item = table.rows().data()
            for (var i = 0; i < item.length; i++) {
                if (String(input).toUpperCase() == String(item[i][0]).toUpperCase()) {
                    status = true
                }
            }
            return status
        }

        //add row
        function addProductRow(data) {
            var item = [
                data['sku'],
                data['part_number'],
                data['product_name'],
                data['category_name'],
                `<input type="number" min="1" class="form-control font-order qty_product" value="1" onfocus="autoSelect(this)">`,
                `<input type="number" min="1" class="form-control font-order hbeli_product" onfocus="autoSelect(this)" value="` + parseInt(data['harga_beli']) + `"> ` +
                `<input type="number" hidden class="hbeli_old" value="` + parseInt(data['harga_beli']) + `">`,
                `<input type="number" min="1" class="form-control font-order hjual_product" onfocus="autoSelect(this)" value="` + parseInt(data['harga_jual']) + `"> `,
                numberWithCommas(parseInt(data['harga_beli'])),
                `<button class="btn btn-delete btn-danger"><i class="fa fa-trash"></i></button>`,
                data['harga_beli']
            ]
            var rowNode = table.row.add(item).draw().node()
            $(rowNode).find('td').addClass('align-middle');
            $(rowNode).find('td').eq(8).addClass('text-center');
            $(rowNode).find('td').eq(7).addClass('qtytot');
            $(rowNode).addClass('data-product')

            getSubTotal()
        }

        function getDataBySkuBarcode(input) {
            $.ajax
                ({
                    type: "GET",
                    data: {
                        input: input
                    },
                    url: "/dashboard/getDataBySkuBarcode",
                    success: (e) => {
                        if (e.status) {
                            if (e.data.length) {
                                if (!checkSkuExist(e.data[0]['sku'])) {
                                    addProductRow(e.data[0])
                                    $("#inputSkuBarcode").val('')
                                } else {
                                    Swal.fire({
                                        title: "Gagal",
                                        text: "SKU " + e.data[0]['sku'] + " sudah ada",
                                        icon: "error"
                                    });
                                }
                            } else {
                                Swal.fire({
                                    title: "Gagal",
                                    text: "Data untuk PLU/Barcode " + input + " Tidak ditemukan di master Produk",
                                    icon: "error"
                                });
                                $("#inputSkuBarcode").val('')
                            }
                        }
                        else {
                            Swal.fire({
                                title: "Gagal",
                                text: e.message,
                                icon: "error"
                            });
                        }
                    },
                    error: function (xhr, status, err) {
                        Swal.fire({
                            title: "Gagal",
                            text: xhr.responseText,
                            icon: "error"
                        });
                    }
                });
        }

        //edit table
        $("#table_product > tbody").on('change', '.hbeli_product, .qty_product', e => {
            getTdTotal(e)
        })

        function getTdTotal(e) {
            let td = getTr(e).querySelector(".qtytot");
            let hbeli_raw = getTr(e).querySelector(".hbeli_product");
            let qty_raw = getTr(e).querySelector(".qty_product");

            let hbeli = $(hbeli_raw).val()
            let qty = $(qty_raw).val()

            $(td).text(numberWithCommas(parseInt(hbeli) * parseFloat(qty)))

            getSubTotal()
        }

        function getSubTotal() {
            var sum = 0
            $('.qtytot').each(function () {
                sum += toNumber($(this).text())
            })
            $('#subtotal_product').text('Rp ' + numberWithCommas(sum))
            getTotalHarga()
        }

        $("#biayaOngkir, #discount").on('change', e => {
            getTotalHarga()
        })

        function getTotalHarga() {
            var ongkir = parseInt($('#biayaOngkir').val())
            var discount = parseInt($('#discount').val())
            var subtotal = toNumber($('#subtotal_product').text().replace('Rp ', ''))
            $('#totalHjual').text('Rp ' + numberWithCommas(subtotal + ongkir - discount))
        }

        //delete
        $("#table_product > tbody").on('click', '.btn-delete', e => {
            const rowData = $('#table_product').DataTable().row(getTr(e)).data();
            Swal.fire({
                title: "Hapus",
                text: "Hapus " + rowData[2] + " ?",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Ya, Hapus",
                cancelButtonText: "Batal"
            }).then((result) => {
                if (result.isConfirmed) {
                    table.row($(getTr(e))).remove().draw()
                    getSubTotal()
                }
            })
        })

        // ================================ LOV ================================

        dt_search("search_table_lov", fill_table_lov_product);
        $('#lovModal').on('shown.bs.modal', function (e) {
            $('#search_table_lov').val('')
            fill_table_lov_product()
            $('#search_table_lov').focus()
        });

        function fill_table_lov_product() {
            const idTabel = "table_lov_product";
            const dt_options = {
                scrollY: '50vh',
                columns: [
                    { data: "sku" },
                    { data: "part_number" },
                    { data: "product_name" },
                    { data: "category_name" }
                ]
            }
            const ajax_options = {
                url: "/dt/lovProduct",
                data: {
                    "search": $('#search_table_lov').val().trim()
                }
            }

            dt_server(idTabel, ajax_options, dt_options);
        }

        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            $.fn.dataTable.tables({ visible: true, api: true }).columns.adjust();
            $('#inputSkuBarcode').focus()
        })

        function addLovData(data, item_table) {
            for (var i = 0; i < data.length; i++) {
                if (!(item_table.includes(data[i]['sku']))) {
                    var item = [
                        data[i]['sku'],
                        data[i]['product_name'],
                        data[i]['category_name']
                    ]
                    tableLov.row.add(item).draw().node()
                }
            }
        }

        function getDataLovProduct() {
            tableLov.clear().draw();
            $.ajax
                ({
                    type: "GET",
                    url: "/dashboard/getDataLovProduct",
                    success: (e) => {
                        if (e.status) {
                            if (e.data.length) {

                                var item = []
                                var product = document.getElementsByClassName('data-product')
                                for (var i = 0; i < product.length; i++) {
                                    item.push($(product[i]).find('td').eq(0).text());
                                }
                                addLovData(e.data, item)
                            }
                        }
                        else {
                            Swal.fire({
                                title: "Gagal",
                                text: e.message,
                                icon: "error"
                            });
                        }
                    },
                    error: function (xhr, status, err) {
                        Swal.fire({
                            title: "Gagal",
                            text: xhr.responseText,
                            icon: "error"
                        });
                    }
                });
        }

        $("#table_lov_product > tbody").on('click', 'tr', e => {
            const rowData = $('#table_lov_product').DataTable().row(getTr(e)).data();
            Swal.fire({
                title: "Pilih Barang",
                text: "Ingin pilih barang " + rowData['product_name'] + " ?",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Iya",
                cancelButtonText: "Tidak",
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    getDataBySkuBarcode(rowData['sku'])
                    $('#lovModal').modal('hide')
                }
            });

        })

        //============================ Save Draft ===========================

        function saveInvoice() {
            if (checkProductExist()) {
                var dataSave = getFormDataAddRec()
                saveReceipt(dataSave)
            }
        }

        function checkPayMethod() {
            var payment = $("#typePaymentInvoice").val();
            var payment_text = $("#typePaymentInvoice option:selected").text();
            var rek = $("#rekInvoice").val() || ' ';

            if (!payment) {
                return false
            }

            if (payment_text.toLowerCase() == 'transfer') {
                if (!rek) {
                    return false
                }
            }
            return true
        }

        function getFormDataAddRec() {
            var dataSave = {}
            //Detail Invoice
            dataSave['outletId'] = $('#outletInvoice').val()
            dataSave['tanggal'] = $('#tanggalInvoice').val()
            dataSave['store_buy'] = $('#storeBuy').val()
            //Informasi Produk
            dataSave['other_fee'] = $('#biayaOngkir').val()
            dataSave['other_note'] = $('#otherInfo').val()
            dataSave['discount'] = $('#discount').val()
            dataSave['subtotal'] = toNumber($('#subtotal_product').text().replace('Rp ', ''))
            var dataProduct = []
            var updatePrice = []
            var product = document.getElementsByClassName('data-product')
            for (var i = 0; i < product.length; i++) {
                var item = {}
                item['sku'] = $(product[i]).find('td').eq(0).text();
                item['part_number'] = $(product[i]).find('td').eq(1).text();
                item['product_name'] = $(product[i]).find('td').eq(2).text();
                item['category_name'] = $(product[i]).find('td').eq(3).text();
                item['qty'] = $(product[i]).find('.qty_product').val();
                item['price'] = $(product[i]).find('.hbeli_product').val();
                item['hjual'] = $(product[i]).find('.hjual_product').val();
                dataProduct.push(item)

                var old_price = $(product[i]).find('.hbeli_old').val();

                if (parseInt(old_price) < parseInt(item['price'])) {
                    var updprice = {}
                    updprice['sku'] = item['sku']
                    updprice['hbeli'] = item['price']
                    updatePrice.push(updprice)
                }
            }

            dataSave['receipt_detail'] = dataProduct
            dataSave['update_price'] = updatePrice
            return dataSave
        }

        function saveReceipt(data, type) {
            $.ajax
                ({
                    type: "POST",
                    data: JSON.stringify(data),
                    contentType: "application/json",
                    url: "/receipt/save",
                    async: false,
                    success: (e) => {
                        if (e.status) {
                            Swal.fire({
                                title: "Sukses Simpan",
                                text: "Berhasil Simpan Data Terima Barang",
                                icon: "success"
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    window.location.href = '/receipt/'
                                }
                            });
                        } else {
                            Swal.fire({
                                title: "Gagal",
                                text: e.message,
                                icon: "error"
                            });
                        }
                    },
                    error: function (xhr, status, err) {
                        Swal.fire({
                            title: "Gagal",
                            text: xhr.responseText,
                            icon: "error"
                        });
                    }
                });
        }

        function checkProductExist() {
            var status = true
            var product = document.getElementsByClassName('data-product')
            if (product.length <= 0) {
                status = false
                Swal.fire({
                    title: "Data Produk Kosong",
                    text: "Harap masukkan produk terlebih dahulu",
                    icon: "error"
                });
            }
            return status
        }

        // ================================ Other ================================
        function on_dismiss() {
            Swal.fire({
                title: "Tutup menu?",
                text: "Data yang diinput akan Hilang",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Ya, Tutup",
                cancelButtonText: "Tidak"
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = "/receipt/"
                }
            });
        }
        function numberWithCommas(x) {
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }
        function numberWithoutCommas(x) {
            return parseInt(x.toString().replace(/\,/g, ''));
        }
        function toNumber(x) {
            return parseInt(x.toString().replace(/\./g, ''));
        }
        function autoSelect(ele) {
            $(ele).select()
        }
        function lastTabGroup() {
            $('.nav-tabs').find('a[href="#informasi-produk"]').click()
        }
        function firstTabGroup() {
            $('.nav-tabs').find('a[href="#detail-invoice"]').click()
        }
    </script>

</body>

</html>